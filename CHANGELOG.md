# 更新日志

## [v2.1.0] - 2026-01-22

### 新增功能 ✨

#### @提及功能
- ✅ 支持 `@机器人名称` 直接召唤特定 AI 机器人
- ✅ 支持 `@all` 一次性召唤所有活跃的 AI 机器人
- ✅ 输入框支持 @ 自动补全，显示可用的机器人列表
- ✅ @提及优先级高于关键词触发

#### 引用回复功能
- ✅ 鼠标悬停消息时显示引用按钮
- ✅ 点击引用按钮可引用任何历史消息
- ✅ 引用的消息会显示在新消息顶部
- ✅ AI 能够理解引用的上下文关系
- ✅ 支持取消引用操作

#### 上下文控制
- ✅ AI 机器人上下文限制为最近 5 条消息
- ✅ 引用的消息额外添加到上下文中
- ✅ 有效控制 token 使用，提高响应速度

### 改进 🎉

- 🔧 优化了消息输入框的用户体验
- 🔧 改进了消息列表的滚动行为
- 🔧 增强了消息显示的视觉效果
- 📝 新增详细的功能使用指南 [MENTION_QUOTE_GUIDE.md](./MENTION_QUOTE_GUIDE.md)
- 📝 更新了 README 文档

### 数据库变更 💾

- 新增 `messages.quoted_message_id` 字段（外键引用 messages.id）
- 新增索引 `idx_messages_quoted_message_id` 提高查询性能

### 技术细节

**触发方式优先级：**
1. @提及（最高优先级）
2. @all（触发所有机器人）
3. 关键词触发（传统方式）

**上下文构建：**
```
上下文 = [
  被引用的消息（如果有）,
  最近5条用户/AI消息,
  当前消息
]
```

### 迁移指南 📖

**新安装：**
- 运行 `pnpm install` 安装依赖
- 运行 `pnpm db:init` 初始化数据库

**从 v2.0.0 升级：**
- 运行 `pnpm db:migrate` 应用数据库迁移
- 迁移会自动添加 `quoted_message_id` 字段

### 使用示例

```
# @特定机器人
用户：@技术助手 这段代码有什么问题？

# @所有机器人
用户：@all 大家怎么看这个方案？

# 引用回复
用户：[点击某条消息的引用按钮]
用户：能详细解释一下这部分吗？
```

### 文档更新

- 新增 [MENTION_QUOTE_GUIDE.md](./MENTION_QUOTE_GUIDE.md) - 详细的功能使用指南
- 更新 [README.md](./README.md) - 添加新功能说明
- 更新路线图，标记已完成的功能

---

## [v2.0.0] - 2026-01-22

### 重大变更 🚨

#### AI 机器人配置方式改变

**之前：**
- 需要在设置页面单独配置全局的 OpenAI API Key
- 所有 AI 机器人共用一个 API Key
- 模型通过下拉菜单选择（仅支持预定义的几个模型）

**现在：**
- 每个 AI 机器人配置独立的 API Key
- 支持配置自定义 Base URL（方便使用代理或第三方服务）
- 模型改为手动输入（支持任何兼容 OpenAI API 的模型）

### 新增功能 ✨

- ✅ 每个 AI 机器人支持独立的 API Key 配置
- ✅ 支持自定义 Base URL（默认：`https://api.openai.com/v1`）
- ✅ 模型名称手动输入，支持更多模型（如 Claude、通义千问等兼容 OpenAI API 的服务）
- ✅ 可以在同一个应用中使用来自不同服务商的 AI 模型

### 改进 🎉

- 🔧 移除了全局 API Key 配置页面（简化配置流程）
- 🔧 优化了 AI 机器人配置表单布局
- 📝 更新了所有相关文档

### 数据库变更 💾

- 新增 `ai_bots.api_key` 字段（必填）
- 新增 `ai_bots.base_url` 字段（默认：`https://api.openai.com/v1`）

### 迁移指南 📖

如果您从旧版本升级，请查看 [MIGRATION.md](./MIGRATION.md) 了解详细的迁移步骤。

### 兼容性说明 ⚠️

此版本包含破坏性变更，升级前请：

1. 备份您的数据库
2. 准备好每个机器人需要的 API Key
3. 按照 [MIGRATION.md](./MIGRATION.md) 执行数据库迁移
4. 在设置页面为每个机器人配置 API Key

### 技术栈更新

- Next.js 15
- React 19
- TypeScript 5
- Tailwind CSS
- shadcn/ui

### 贡献者

感谢所有为这个版本做出贡献的开发者！

---

## [v1.0.0] - 初始版本

初始发布版本，包含以下功能：

- 多 AI 机器人支持
- RSS 订阅
- Bark 推送通知
- 现代化的聊天界面
- 响应式设计
